# Chapter 11 - 정규 표현식으로 해결하는 일반적인 문제들

- 주어진 상황에서 얼마나 많은 조건을 다룰지 설정하는 패턴의 범위 사이에는 항상 교환 조건(trade-off)이 존재

## 북미 전화번호

- 북미 지역의 전화번호 형식을 정의
  - `(번호 계획 지역) (세 자리 숫자 국번)- (네 자리 숫자)`
- `\(?[2-9]\d\d\)?[ -]?[2-9]\d\d-\d{4}`
  - `\(?` : 여는 괄호가 없는 경우나 여는 괄호가 하나
  - `[2-9]\d\d` : 세 자리 지역번호 (첫 번째 숫자는 2에서 9 사이어야 함)
  - `\)?` : 닫는 괄호가 없는 경우나 닫는 괄호가 하나
  - `[ -]?` : 공백 문자나 하이픈 한 개와 일치
  - `[2-9]\d\d-\d{4}` : 전화번호의 나머지 부분과 일치 ((세 자리 숫자 국번)- (네 자리 숫자))
  - 닫는 괄호를 `[\).]?`, 하이픈을 `[-.]`로 수정함으로 써 `555.555.5555`와 같은 다른 형태의 번호도 다룰 수 있음

## 미국 우편번호

- 기존의 다섯 자리 우편번호를 사용하거나 더 정확도가 높아진 ZIP+4 사용
  - 앞에 있는 다섯 자리 숫자와 추가된 네 자리 숫자는 하이픈으로 구분
- `\d{5}(-\d{4})?`
  - `\d{5}` : 다섯 자리 숫자와 일치
  - `(-\d{4})?` : 하이픈 다음에 이어지는 네 자리 숫자와 일치, 있거나 없을 수도 있으므로 하위 표현 변경 후 물음표(?) 사용

## 캐나다 우편번호

- 문자 여섯 개로 구성 및 문자와 숫자가 번갈아가면서 나옴
  - 처음 세 자리 숫자는 전달 분류 지역, 두 번째에 연속해 나오는 숫자는 지역 배달 구역
  - 일반적으로 전달 분류 지역과 지역 배달 구역은 빈칸으로 구분
- `[ABCEGHJKLMNPRSTVXY]\d[A-Z] \d[A-Z]\d`
  - `[ABCEGHJKLMNPRSTVXY]\d[A-Z]` : 유효한 문자 18개 가운데 하나와 일치
  - `\d[A-Z]` : 한자리 숫자와 바로 다음에 알파벳 A부터 Z 가운데 하나와 일치
  - `\d[A-Z]\d` : 한자리 숫자와 바로 다음에 알파벳 A부터 Z 가운데 하나가 등장하고 다시 한 숫자로 이어짐

## 영국 우편번호

- 다섯 자리, 여섯 자리, 일곱 자리이며 숫자와 문자로 구성
  - 외부 우편 번호와 내부 우편 번호로 나누어짐 (외부 번호, 내부 번호)
  - 외부 번호는 한자리나 두 자리로 이루어진 알파벳 문자와 이 뒤를 이어 한자리나 두 자리 숫자 혹은 한자리나 두 자리 문자 뒤에 한자리 숫자와 한자리 문자가 차례로 나옴
  - 내부 번호는 항상 한자리 숫자 뒤에 두 자리 문자, C, I, K, M, O, V는 제외
  - 내부 번호와 외부 번호는 빈칸으로 구별
- `[A-Z]{1,2}\d[A-Z\d]? \d[ABD-HJNP-UW-Z]{2}`
  - `[A-Z]{1,2}\d` : 한자리 혹은 두 자리로 구성된 알파벳 문자가 나오고 바로 뒤에 있는 한자리 숫자와 일치
  - `[A-Z\d]?` : 뒤로 영숫자 문자가 더 있다면, 이 영숫자 문자와 일치
  - `\d[ABD-HJNP-UW-Z]{2}` : 내부 번호 패턴, 숫자 하나와 일치 후 바로 뒤에 허용된 알파벳 문자 두 개와 일치

## 미국 사회보장번호

- 숫자로 구성, 세 묶음이 하이픈으로 나누어져 구분
  - 첫 부분은 세 자리 숫자
  - 두 번째 부분은 두 자리 숫자
  - 마지막 부분은 네 자리 숫자
- `\d{3}-\d{2}-\d{4}`
  - 숫 자 세 개, 하이픈, 두 자리 숫자, 하이픈, 네 자리 숫자와 일치

## IP 주소

- 네 바이트(범위는 각각 0에서 255 사이)
  - 숫자 네 묶음을 주로 마침표(.)로 구분해 표현
- `(((25[0-5])|(2[0-4]\d)|(1\d{2})|(\d{1,2}))\.){3}(((25[0-5])|(2[0-4]\d)|(1\d{2})|(\d{1,2})))`
  - 중첩된 하위 표현식을 연속해서 사용
  - `(((25[0-5])|(2[0-4]\d)|(1\d{2})|(\d{1,2}))\.)` : 하위 표현식 네 개를 중첩한 하위 표현식 집합
    - `(\d{1,2})` : 한자리나 두 자리 숫자 -> 0에서 99사이의 숫자
    - `(1\d{2})` : 1로 시작하는 세 자리 숫자 -> 100에서 199 사이의 숫자
    - `(2[0-4]\d)` : 200에서 249 사이의 숫자
    - `(25[0-5])` : 250에서 255 사이의 숫자
    - 네 가지 표현식 중 표현식 하나하고만 일치
    - `\.` : 마침표(.)와 일치
    - `{3}` : 이 패턴을 세 번 반복
  - 마지막으로 숫자 범위가 한 번 더 나와 IP 주소와 일치

## URL

- `https?:\/\/[-\w.]+(:\d+)?(\/([\w\/_.]*)?)?`
  - `https?:\/\/` : `http://`, `https://` 중 하나와 일치
  - `[-\w.]+` : 호스트 이름과 일치
  - `(:\d+)?` : 포트 번호가 있을 경우 일치
  - `(\/([\w\/_.]*)?)?` : 경로와 일치

## 완전한 URL

- `https?:\/\/(\w*:\w*@)?[-\w.]+(:\d+)?(\/([\w\/_.]*(\?\S+)?)?)?`
  - `(\w*:\w*@)?` : 사용자 이름과 암호가 포함된 경우 검사 (콜론(:)으로 구분하고 암호 마지막에 앳(@)이 붙음)
  - `(\?\S+)?` : 쿼리 문자열과 일치 (물음표로 없는 경우에도 일치)
  - 앞선 URL보다 더 복잡한 패턴이기 때문에 더 느리게 실행

## 이메일 주소

- `(\w+\.)*\w+@(\w+\.)+[A-Za-z]+`
  - `(\w+\.)*\w+` : 사용자 이름 부분인 앳(@) 앞쪽과 모두 일치 (마침표(.)로 끝나는 요소가 있다면 하나 이상 일치)
  - `(\w+\.)+` : 마침표로 끝나는 하나 이상의 요소와 일치
  - `[A-Za-z]+` : 최상위 도메인과 일치

## HTML 주석

- `<!-{2,}.*?-{2,}>`
  - `<!-{2,}` : 주석의 시작과 일치
  - `.*?` : 탐욕적이지 않으며 주석의 예문과 일치
  - `-{2,}>` : 주석의 마지막과 일치

## 자바스크립트 주석

- `\/\/.*`
  - `\/\/.*`는 `//`와 이어지는 주석 본문과 일치

## 신용카드 번호

- 빈칸이나 하이픈이 제거된 상태라고 가정
- `5[1-5]\d{14}` (마스터카드)
  - `5[1-5]` : 처음 두 자리 숫자와 일치
  - `\d{14}` : 다음에 오는 열네 자리 숫자와 일치
- `4\d{12}(\d{3})?` (비자)
  - `\d{12}` : 열두 자리 숫자와 일치
  - `(\d{3})?` : 열두 자리 숫자 뒤로 숫자가 세 개 더 있는 경우와 일치
- `3[47]\d{13}` (아메리칸익스프레스)
  - `3[47]` : 첫 두 자리 숫자와 일치 (34, 37)
  - `\d{13}` : 나머지 열세 자리 숫자와 일치
- `6011\d{14}` (디스커버)
  - 디스커버는 열여덟 자리 숫자이면서 6011로 시작
- `(30[0-5]|36\d|38\d)\d{11}`
  - `30[0-5]` : 300에서 305 사이에 있는 숫자와 일치
  - `36\d` : 36으로 시작하는 세 자리 숫자
  - `38\d` : 38로 시작하는 세 자리 숫자
  - `\d{11}` : 나머지 열한 자리 숫자와 일치

## 주민등록번호

- `\d+-\d+` (최대한 단순하게 표현한 주민등록번호)
  - `\d` : 앞쪽 생년월일과 주민번호 뒷자리와 일치
  - 일치할 숫자의 수를 명시하지 않았기 때문에 우편번호와도 일치
- `\d{6}-\d{7}`
  - 99월 99일과 같은 없는 날짜와도 일치
- `\d{2}(0[1-9]|1[0-2])(0[1-9]|[12][0-9]|3[01])-\d{7}`
  - `\d{2}` : 주민번호의 연도 부분과 일치
  - `(0[1-9]|1[0-2])` : or 연산자로 0으로 시작할 땐 두 번째 자리에 1,9이며 1로 시작할 땐 두 번째 자리에 0과 2사이의 수
  - `(0[1-9]|[12][0-9]|3[01])` : 주민번호의 날짜와 일치하는 패턴
- `\d{2}(0[1-9]|1[0-2])(0[1-9]|[12][0-9]|3[01])-[1-4]\d{6}`
  - 뒷자리에 시작하는 숫자도 일치 시킴

## 미국식 날짜 형식을 국제표준(ISO 8601) 날짜 형식으로 바꾸기

- `mm/dd/yyyy` 날짜 형식을 `yyyy-mm-dd` 형식으로 바꾸기
- 정규표현식 : `([\d]{2})\/([\d]{2})\/([\d]{4})`
  - 두 자리의 숫자와 네 자리의 숫자를 일치시킴
- 치환표현식 : `$3-$1-$2`
  - 치환 패턴에서 월, 일, 연도의 순서를 바꿈

## 함수 이름 바꾸기

- `get_id`라는 함수를 `get_userid`로 변경 (`id`인 키값 역시 `userid`로 변경)
- 간단한 정규표현식과 치환표현식
  - 정규표현식 : `id`
  - 치환표현식 : `userid`
  - `get_id` 함수와 관련된 것이 아닌 다른 값들도 변경된다.
- 앞뒤를 하위 표현식으로 묶음
  - 정규표현식 : `([_'])(id)(['(])`
  - 치환표현식 : `$1userid$3`
  - 첫 번째 하위 표현식은 `_`나 `'`, 두 번째 하위 표현식은 `id`, 세 번째 하위 표현식은 `'`나 `(`와 일치

## 정규 표현식과 한글과 유니코드

### 한글 일치시키기

- 한글은 영어와 마찬가지로 문자 그대로 일치 (기본적인 사항은 거의 같음)
  - `한글은 \w와 일치하지는 X` (`\w`는 [A-Za-z0-9])
  - `\b`는 영단어의 경계만 나타냄 (`\w`와 `\W` 사이) -> 한글의 경우 전후방 탐사로 `\s`와 일치하는 공백을 찾을 것
  - 공백이 없을 시 `(?<=[^가-힣])` -> 이 패턴은 한글이 아닌 문자와 모두 일치

### 유니코드 일치시키기

- 유니코드는 문자마다 순서대로 번호를 할당, 이 번호를 직접 사용해 유니코드 문자와 일치시키는 것이 가능
  - ex) `\u00a9` -> 저작권 표시와 일치
